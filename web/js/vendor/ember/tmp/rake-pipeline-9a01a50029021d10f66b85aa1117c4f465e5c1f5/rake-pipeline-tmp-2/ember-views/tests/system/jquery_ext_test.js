minispade.register('ember-views/~tests/system/jquery_ext_test', "(function() {// ==========================================================================\n// Project:   Ember - JavaScript Application Framework\n// Copyright: ©2006-2011 Strobe Inc. and contributors.\n//            Portions ©2008-2011 Apple Inc. All rights reserved.\n// License:   Licensed under MIT license (see license.js)\n// ==========================================================================\n\nvar view, dispatcher;\n\n// Adapted from https://github.com/jquery/jquery/blob/f30f7732e7775b6e417c4c22ced7adb2bf76bf89/test/data/testinit.js\nvar fireNativeWithDataTransfer;\nif (document.createEvent) {\n  fireNativeWithDataTransfer = function(node, type, dataTransfer) {\n    var event = document.createEvent('HTMLEvents');\n    event.initEvent(type, true, true);\n    event.dataTransfer = dataTransfer;\n    node.dispatchEvent(event);\n  };\n} else {\n  fireNativeWithDataTransfer = function(node, type, dataTransfer) {\n    var event = document.createEventObject();\n    event.dataTransfer = dataTransfer;\n    node.fireEvent('on' + type, event);\n  };\n}\n\nmodule(\"Ember.EventDispatcher\", {\n  setup: function() {\n    Ember.run(function() {\n      dispatcher = Ember.EventDispatcher.create();\n      dispatcher.setup();\n    });\n  },\n\n  teardown: function() {\n    Ember.run(function() {\n      if (view) { view.destroy(); }\n      dispatcher.destroy();\n    });\n  }\n});\n\ntest(\"jQuery.event.fix copies over the dataTransfer property\", function() {\n  var originalEvent;\n  var receivedEvent;\n\n  originalEvent = {\n    type: 'drop',\n    dataTransfer: 'success',\n    target: document.body\n  };\n\n  receivedEvent = Ember.$.event.fix(originalEvent);\n\n  ok(receivedEvent !== originalEvent, \"attributes are copied to a new event object\");\n  equal(receivedEvent.dataTransfer, originalEvent.dataTransfer, \"copies dataTransfer property to jQuery event\");\n});\n\ntest(\"drop handler should receive event with dataTransfer property\", function() {\n  var receivedEvent;\n  var dropCalled = 0;\n\n  view = Ember.View.create({\n    render: function(buffer) {\n      buffer.push('please drop stuff on me');\n      this._super(buffer);\n    },\n\n    drop: function(evt) {\n      receivedEvent = evt;\n      dropCalled++;\n    }\n  });\n\n  Ember.run(function() {\n    view.append();\n  });\n\n  fireNativeWithDataTransfer(view.$().get(0), 'drop', 'success');\n\n  equal(dropCalled, 1, \"called drop handler once\");\n  equal(receivedEvent.dataTransfer, 'success', \"copies dataTransfer property to jQuery event\");\n});\n\n})();\n//@ sourceURL=ember-views/~tests/system/jquery_ext_test");