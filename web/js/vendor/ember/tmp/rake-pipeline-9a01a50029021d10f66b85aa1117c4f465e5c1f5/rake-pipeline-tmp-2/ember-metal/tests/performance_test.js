minispade.register('ember-metal/~tests/performance_test', "(function() {/**\n  This test file is designed to capture performance regressions related to\n  deferred computation. Things like run loops, computed properties, and bindings\n  should run the minimum amount of times to achieve best performance, so any\n  bugs that cause them to get evaluated more than necessary should be put here.\n*/\n\nmodule(\"Computed Properties - Number of times evaluated\");\n\ntest(\"computed properties that depend on multiple properties should run only once per run loop\", function() {\n  var obj = {a: 'a', b: 'b', c: 'c'};\n  var count = 0;\n  Ember.defineProperty(obj, 'abc', Ember.computed(function(key) {\n    count++;\n    return 'computed '+key;\n  }).property('a', 'b', 'c'));\n\n  Ember.beginPropertyChanges();\n  Ember.set(obj, 'a', 'aa');\n  Ember.set(obj, 'b', 'bb');\n  Ember.set(obj, 'c', 'cc');\n  Ember.endPropertyChanges();\n\n  Ember.get(obj, 'abc');\n\n  equal(count, 1, \"The computed property is only invoked once\");\n});\n\ntest(\"computed properties that depend on multiple properties should run only once per run loop\", function() {\n  var obj = {a: 'a', b: 'b', c: 'c'};\n  var cpCount = 0, obsCount = 0;\n\n  Ember.defineProperty(obj, 'abc', Ember.computed(function(key) {\n    cpCount++;\n    return 'computed '+key;\n  }).property('a', 'b', 'c'));\n\n  Ember.addObserver(obj, 'abc', function() {\n    obsCount++;\n  });\n\n  Ember.beginPropertyChanges();\n  Ember.set(obj, 'a', 'aa');\n  Ember.set(obj, 'b', 'bb');\n  Ember.set(obj, 'c', 'cc');\n  Ember.endPropertyChanges();\n\n  Ember.get(obj, 'abc');\n\n  equal(cpCount, 1, \"The computed property is only invoked once\");\n  equal(obsCount, 1, \"The observer is only invoked once\");\n});\n\ntest(\"computed properties are not executed if they are the last segment of an observer chain pain\", function() {\n  var foo = { bar: { baz: { } } };\n\n  var count = 0;\n\n  Ember.defineProperty(foo.bar.baz, 'bam', Ember.computed(function() {\n    count++;\n  }).property());\n\n  Ember.addObserver(foo, 'bar.baz.bam', function() {});\n\n  Ember.propertyDidChange(Ember.get(foo, 'bar.baz'), 'bam');\n\n  equal(count, 0, \"should not have recomputed property\");\n});\n\n})();\n//@ sourceURL=ember-metal/~tests/performance_test");