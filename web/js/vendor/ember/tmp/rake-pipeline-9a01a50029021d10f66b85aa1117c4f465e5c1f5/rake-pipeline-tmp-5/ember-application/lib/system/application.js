minispade.register('ember-application/system/application', "(function() {// ==========================================================================\n// Project:   Ember - JavaScript Application Framework\n// Copyright: ©2006-2011 Strobe Inc. and contributors.\n//            Portions ©2008-2011 Apple Inc. All rights reserved.\n// License:   Licensed under MIT license (see license.js)\n// ==========================================================================\n\nvar get = Ember.get, set = Ember.set;\n\n/**\n  @class\n\n  An Ember.Application instance serves as the namespace in which you define your\n  application's classes. You can also override the configuration of your\n  application.\n\n  By default, Ember.Application will begin listening for events on the document.\n  If your application is embedded inside a page, instead of controlling the\n  entire document, you can specify which DOM element to attach to by setting\n  the `rootElement` property to a CSS selector.\n\n      MyApp = Ember.Application.create({\n        rootElement: '#my-app'\n      });\n\n  The root of an Ember.Application must not be removed during the course of the\n  page's lifetime. If you have only a single conceptual application for the\n  entire page, and are not embedding any third-party Ember applications\n  in your page, use the default document root for your application.\n\n  You only need to specify the root if your page contains multiple instances\n  of Ember.Application.\n\n  @extends Ember.Object\n*/\nEmber.Application = Ember.Namespace.extend(\n/** @scope Ember.Application.prototype */{\n\n  /**\n    The root DOM element of the Application.\n\n    Can be specified as DOMElement or a selector string.\n\n    @type DOMElement\n    @default 'body'\n  */\n  rootElement: 'body',\n\n  /**\n    @type Ember.EventDispatcher\n    @default null\n  */\n  eventDispatcher: null,\n\n  /**\n    @type Object\n    @default null\n  */\n  customEvents: null,\n\n  /** @private */\n  init: function() {\n    if (!this.$) { this.$ = Ember.$; }\n\n    var eventDispatcher,\n        rootElement = get(this, 'rootElement');\n    this._super();\n\n    eventDispatcher = Ember.EventDispatcher.create({\n      rootElement: rootElement\n    });\n\n    set(this, 'eventDispatcher', eventDispatcher);\n\n    // Start off the number of deferrals at 1. This will be\n    // decremented by the Application's own `initialize` method.\n    this._readinessDeferrals = 1;\n\n    this.waitForDOMContentLoaded();\n  },\n\n  waitForDOMContentLoaded: function() {\n    this.deferReadiness();\n\n    var self = this;\n    this.$().ready(function() {\n      self.advanceReadiness();\n    });\n  },\n\n  deferReadiness: function() {\n    Ember.assert(\"You cannot defer readiness since the `ready()` hook has already been called.\", this._readinessDeferrals > 0);\n    this._readinessDeferrals++;\n  },\n\n  advanceReadiness: function() {\n    this._readinessDeferrals--;\n\n    if (this._readinessDeferrals === 0) {\n      Ember.run.once(this, this.didBecomeReady);\n    }\n  },\n\n  /**\n    Instantiate all controllers currently available on the namespace\n    and inject them onto a router.\n\n    Example:\n\n        App.PostsController = Ember.ArrayController.extend();\n        App.CommentsController = Ember.ArrayController.extend();\n\n        var router = Ember.Router.create({\n          ...\n        });\n\n        App.initialize(router);\n\n        router.get('postsController')     // <App.PostsController:ember1234>\n        router.get('commentsController')  // <App.CommentsController:ember1235>\n\n        router.get('postsController.router') // router\n  */\n  initialize: function(router) {\n    var properties = Ember.A(Ember.keys(this)),\n        injections = get(this.constructor, 'injections'),\n        namespace = this, controller, name;\n\n    if (!router && Ember.Router.detect(namespace['Router'])) {\n      router = namespace['Router'].create();\n      this._createdRouter = router;\n    }\n\n    if (router) {\n      set(this, 'router', router);\n\n      // By default, the router's namespace is the current application.\n      //\n      // This allows it to find model classes when a state has a\n      // route like `/posts/:post_id`. In that case, it would first\n      // convert `post_id` into `Post`, and then look it up on its\n      // namespace.\n      set(router, 'namespace', this);\n    }\n\n    injections.forEach(function(injection) {\n      properties.forEach(function(property) {\n        injection[1](namespace, router, property);\n      });\n    });\n\n    Ember.runLoadHooks('application', this);\n\n    // At this point, any injections or load hooks that would have wanted\n    // to defer readiness have fired.\n    this.advanceReadiness();\n\n    return this;\n  },\n\n  /** @private */\n  didBecomeReady: function() {\n    var eventDispatcher = get(this, 'eventDispatcher'),\n        customEvents    = get(this, 'customEvents'),\n        router;\n\n    eventDispatcher.setup(customEvents);\n\n    this.ready();\n\n    router = get(this, 'router');\n\n    if (router && router instanceof Ember.Router) {\n      this.startRouting(router);\n    }\n  },\n\n  /**\n    @private\n\n    If the application has a router, use it to route to the current URL, and\n    trigger a new call to `route` whenever the URL changes.\n  */\n  startRouting: function(router) {\n    var location = get(router, 'location'),\n        rootElement = get(this, 'rootElement'),\n        applicationController = get(router, 'applicationController');\n\n    Ember.assert(\"ApplicationView and ApplicationController must be defined on your application\", (this.ApplicationView && applicationController) );\n\n    var applicationView = this.ApplicationView.create({\n      controller: applicationController\n    });\n    this._createdApplicationView = applicationView;\n\n    applicationView.appendTo(rootElement);\n\n    router.route(location.getURL());\n    location.onUpdateURL(function(url) {\n      router.route(url);\n    });\n  },\n\n  /**\n    Called when the Application has become ready.\n    The call will be delayed until the DOM has become ready.\n  */\n  ready: Ember.K,\n\n  /** @private */\n  willDestroy: function() {\n    get(this, 'eventDispatcher').destroy();\n    if (this._createdRouter)          { this._createdRouter.destroy(); }\n    if (this._createdApplicationView) { this._createdApplicationView.destroy(); }\n  },\n\n  registerInjection: function(options) {\n    this.constructor.registerInjection(options);\n  }\n});\n\nEmber.Application.reopenClass({\n  concatenatedProperties: ['injections'],\n  injections: Ember.A(),\n  registerInjection: function(options) {\n    var injections = get(this, 'injections'),\n        before = options.before,\n        name = options.name,\n        injection = options.injection,\n        location;\n\n    if (before) {\n      location = injections.find(function(item) {\n        if (item[0] === before) { return true; }\n      });\n      location = injections.indexOf(location);\n    } else {\n      location = get(injections, 'length');\n    }\n\n    injections.splice(location, 0, [name, injection]);\n  }\n});\n\nEmber.Application.registerInjection({\n  name: 'controllers',\n  injection: function(app, router, property) {\n    if (!/^[A-Z].*Controller$/.test(property)) { return; }\n\n    var name = property.charAt(0).toLowerCase() + property.substr(1),\n        controller = app[property].create();\n\n    router.set(name, controller);\n\n    controller.setProperties({\n      target: router,\n      controllers: router,\n      namespace: app\n    });\n  }\n});\n\nEmber.runLoadHooks('Ember.Application', Ember.Application);\n\n\n})();\n//@ sourceURL=ember-application/system/application");